<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto-Hash Lab v14</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #f8fafc; font-family: 'Inter', sans-serif; }
        
        /* Paneles */
        .lab-panel { background: #ffffff; border: 1px solid #e2e8f0; border-radius: 6px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); }
        
        /* Gel de Simulación */
        .gel-simulation { 
            background: linear-gradient(180deg, #f1f5f9 0%, #e2e8f0 100%); 
            border: 2px solid #cbd5e1; 
            position: relative; 
            min-height: 400px; 
            box-shadow: inset 0 2px 15px rgba(0,0,0,0.05);
            border-radius: 4px;
        }

        /* Bandas de ADN */
        .dna-band { 
            border-bottom: 1px solid rgba(255,255,255,0.3); 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
            transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 1px;
        }
        
        /* Estilos de Carril */
        .band-a { background: #2563eb; } /* Azul Real */
        .band-b { background: #059669; } /* Esmeralda */

        /* Efectos de Reproducción */
        .band-a.playing { 
            background: #60a5fa; transform: scaleX(2.5) scaleY(1.2); 
            box-shadow: 0 0 20px rgba(96, 165, 250, 0.8); z-index: 50; 
        }
        .band-b.playing { 
            background: #34d399; transform: scaleX(2.5) scaleY(1.2); 
            box-shadow: 0 0 20px rgba(52, 211, 153, 0.8); z-index: 50; 
        }

        /* Tipografía Técnica */
        .mono { font-family: 'JetBrains Mono', 'Fira Code', monospace; }
        .ui-label { font-size: 0.65rem; font-weight: 800; color: #64748b; letter-spacing: 0.1em; text-transform: uppercase; }

        /* Elementos UI */
        .lane-divider { border-top: 2px dashed #94a3b8; width: 100%; position: absolute; top: 50%; z-index: 5; opacity: 0.5; }
        #playhead { 
            position: absolute; top: 0; width: 2px; height: 100%; 
            background: #ef4444; display: none; z-index: 40; 
            box-shadow: 0 0 10px #ef4444;
        }
        .btn-sync { 
            background: linear-gradient(135deg, #1e3a8a 0%, #064e3b 100%); 
            transition: transform 0.1s;
        }
        .btn-sync:active { transform: scale(0.98); }

        /* Estilo para el nombre del archivo visible */
        .file-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            border: 1px solid rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="p-2 md:p-8 min-h-screen flex items-center justify-center bg-slate-100">

    <div class="w-full max-w-7xl flex flex-col gap-5">
        
        <header class="lab-panel p-5 flex flex-col md:flex-row justify-between items-center gap-4 border-t-4 border-t-slate-900 bg-white">
            <div class="flex items-center gap-4">
                <div class="h-10 w-10 bg-slate-900 rounded flex items-center justify-center text-white font-bold mono">IO</div>
                <div>
                    <h1 class="text-2xl font-black text-slate-900 tracking-tighter italic leading-none">
                        CRYPTO-HASH <span class="text-blue-600">LAB</span>
                    </h1>
                    <p class="ui-label mt-1">Secuenciador Criptográfico de Hash-256</p>
                </div>
            </div>
            
            <div class="flex flex-wrap justify-center gap-3">
                <button onclick="playDualSync()" class="btn-sync text-white text-[10px] font-bold px-6 py-3 rounded shadow-lg flex items-center gap-2 hover:opacity-90 ring-1 ring-slate-900">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M4 4l12 6-12 6z"/></svg>
                    REPRODUCCIÓN DUAL (SYNC)
                </button>
                <button id="btnDownload" class="bg-slate-800 text-white text-[10px] font-bold px-5 py-3 rounded hover:bg-slate-700 flex items-center gap-2 shadow-md">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                    REPORTE PNG
                </button>
            </div>
        </header>

        <section class="lab-panel p-1 shadow-xl overflow-hidden">
            <div class="bg-slate-50 p-3 border-b border-slate-100 flex justify-between items-center">
                <div id="similarity" class="mono font-bold text-xs text-slate-400">ESPERANDO DATOS...</div>
                <div id="recordStatus" class="text-[10px] text-red-600 font-bold hidden animate-pulse flex items-center gap-2">
                    <span class="h-2 w-2 bg-red-600 rounded-full"></span> GRABANDO MASTER AUDIO...
                </div>
            </div>

            <div class="relative h-24 w-full bg-white border-b border-slate-200">
                <canvas id="peakCanvas" class="w-full h-full"></canvas>
                <span class="absolute top-1 left-2 ui-label text-slate-300">ESPECTROGRAMA</span>
            </div>
            
            <div class="p-4 md:p-6 bg-slate-50">
                <div class="flex justify-between mb-1 px-2">
                    <div class="flex items-center gap-2">
                         <span class="ui-label text-blue-600">CARRIL A (PRIMARIO)</span>
                         <span id="labelA" class="text-[9px] font-mono text-slate-400 opacity-0 transition-opacity duration-300"></span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span id="labelB" class="text-[9px] font-mono text-slate-400 opacity-0 transition-opacity duration-300"></span>
                        <span class="ui-label text-emerald-600">CARRIL B (SECUNDARIO)</span>
                    </div>
                </div>
                <div id="visualizer" class="gel-simulation w-full overflow-hidden rounded">
                    <div id="playhead"></div>
                    <div class="lane-divider"></div>
                </div>
                <div class="flex justify-between mt-2 px-2">
                    <span class="ui-label">0x00 (INICIO)</span>
                    <span class="ui-label">0xFF (FIN)</span>
                </div>
            </div>
        </section>

        <footer class="grid grid-cols-1 md:grid-cols-2 gap-5">
            
            <div class="lab-panel border-l-4 border-l-blue-600 p-5 flex flex-col gap-4">
                <div class="flex justify-between items-center border-b border-slate-100 pb-2">
                    <div class="flex flex-col gap-1">
                        <span class="ui-label text-blue-600">FUENTE A</span>
                        <div class="file-badge bg-blue-50 text-blue-800 border-blue-200">
                            <span class="opacity-50 mr-1">FILE:</span>
                            <span id="nameA" class="truncate max-w-[120px] md:max-w-[180px]">---</span>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="playSequence('A')" class="bg-blue-50 text-blue-700 hover:bg-blue-100 text-[10px] px-3 py-1 font-bold rounded border border-blue-200">PLAY A</button>
                        <button onclick="exportAudio('A')" class="bg-blue-600 text-white hover:bg-blue-700 text-[10px] px-3 py-1 font-bold rounded shadow">EXP. AUDIO</button>
                        <button onclick="exportLaneImage('A')" class="bg-slate-700 text-white hover:bg-slate-800 text-[10px] px-3 py-1 font-bold rounded shadow border border-slate-600" title="Exportar Ficha A">EXP. IMG</button>
                    </div>
                </div>
                
                <div class="space-y-3">
                    <input type="text" id="textA" class="w-full border-2 border-slate-200 p-2 text-sm mono outline-none focus:border-blue-500 rounded bg-slate-50 focus:bg-white transition-all" placeholder="Escribir datos A...">
                    
                    <div id="dropA" onclick="document.getElementById('fileA').click()" class="border-2 border-dashed border-slate-300 p-4 text-center cursor-pointer hover:bg-blue-50 hover:border-blue-400 transition-all rounded group">
                        <input type="file" id="fileA" class="hidden">
                        <p class="ui-label group-hover:text-blue-600">CLIC O ARRASTRAR ARCHIVO A</p>
                    </div>
                    
                    <div class="bg-slate-900 p-3 rounded">
                        <p class="text-[9px] text-slate-500 font-bold mb-1">HASH SHA-256 A:</p>
                        <div id="hashA" class="mono text-[10px] text-blue-400 break-all leading-tight">ESPERANDO...</div>
                    </div>
                </div>
            </div>

            <div class="lab-panel border-l-4 border-l-emerald-600 p-5 flex flex-col gap-4">
                <div class="flex justify-between items-center border-b border-slate-100 pb-2">
                    <div class="flex flex-col gap-1">
                        <span class="ui-label text-emerald-600">FUENTE B</span>
                        <div class="file-badge bg-emerald-50 text-emerald-800 border-emerald-200">
                            <span class="opacity-50 mr-1">FILE:</span>
                            <span id="nameB" class="truncate max-w-[120px] md:max-w-[180px]">---</span>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="playSequence('B')" class="bg-emerald-50 text-emerald-700 hover:bg-emerald-100 text-[10px] px-3 py-1 font-bold rounded border border-emerald-200">PLAY B</button>
                        <button onclick="exportAudio('B')" class="bg-emerald-600 text-white hover:bg-emerald-700 text-[10px] px-3 py-1 font-bold rounded shadow">EXP. AUDIO</button>
                        <button onclick="exportLaneImage('B')" class="bg-slate-700 text-white hover:bg-slate-800 text-[10px] px-3 py-1 font-bold rounded shadow border border-slate-600" title="Exportar Ficha B">EXP. IMG</button>
                    </div>
                </div>
                
                <div class="space-y-3">
                    <input type="text" id="textB" class="w-full border-2 border-slate-200 p-2 text-sm mono outline-none focus:border-emerald-500 rounded bg-slate-50 focus:bg-white transition-all" placeholder="Escribir datos B...">
                    
                    <div id="dropB" onclick="document.getElementById('fileB').click()" class="border-2 border-dashed border-slate-300 p-4 text-center cursor-pointer hover:bg-emerald-50 hover:border-emerald-400 transition-all rounded group">
                        <input type="file" id="fileB" class="hidden">
                        <p class="ui-label group-hover:text-emerald-600">CLIC O ARRASTRAR ARCHIVO B</p>
                    </div>
                    
                    <div class="bg-slate-900 p-3 rounded">
                        <p class="text-[9px] text-slate-500 font-bold mb-1">HASH SHA-256 B:</p>
                        <div id="hashB" class="mono text-[10px] text-emerald-400 break-all leading-tight">ESPERANDO...</div>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <canvas id="exportCanvas" style="display:none;"></canvas>

    <script>
        // --- CONFIGURACIÓN E INICIALIZACIÓN ---
        const visualizer = document.getElementById('visualizer');
        const playhead = document.getElementById('playhead');
        const peakCanvas = document.getElementById('peakCanvas');
        const pCtx = peakCanvas.getContext('2d');
        const recordStatus = document.getElementById('recordStatus');

        let dataA = { hash: "", name: "VACÍO" };
        let dataB = { hash: "", name: "VACÍO" };
        let audioCtx;
        
        // Frecuencias: Escala Cromática de 4 octavas mapeada a 0-15 HEX
        const frequencies = [
            261.63, 277.18, 293.66, 311.13, 329.63, 349.23, 369.99, 392.00, // C4 a G4
            415.30, 440.00, 466.16, 493.88, 523.25, 554.37, 587.33, 622.25  // G#4 a D#5
        ];

        // --- MOTOR DE AUDIO ---
        function initAudio() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            return audioCtx;
        }

        function createOscillatorNode(freq, time, duration, type, gainValue, destination) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            
            osc.type = type; 
            osc.frequency.setValueAtTime(freq, time);
            
            // Envolvente ADSR simple
            gain.gain.setValueAtTime(0, time);
            gain.gain.linearRampToValueAtTime(gainValue, time + 0.02); // Attack
            gain.gain.exponentialRampToValueAtTime(0.001, time + duration); // Decay
            
            osc.connect(gain);
            gain.connect(destination);
            
            osc.start(time);
            osc.stop(time + duration);
        }

        function playTone(freq, type, vol) {
             const ctx = initAudio();
             const osc = ctx.createOscillator();
             const gain = ctx.createGain();
             osc.type = type;
             osc.frequency.setValueAtTime(freq, ctx.currentTime);
             gain.gain.setValueAtTime(vol, ctx.currentTime);
             gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.15);
             osc.connect(gain); gain.connect(ctx.destination);
             osc.start(); osc.stop(ctx.currentTime + 0.15);
        }

        async function playSequence(lane, isExport = false) {
            const ctx = initAudio();
            if (ctx.state === 'suspended') await ctx.resume();

            if(isExport) playTone(880, 'sine', 0.1); // Sonido de inicio grabación

            const hash = lane === 'A' ? dataA.hash : dataB.hash;
            if(!hash) return;

            const dest = ctx.createMediaStreamDestination();
            let recorder = null;
            let chunks = [];

            if (isExport) {
                recorder = new MediaRecorder(dest.stream);
                recorder.ondataavailable = e => chunks.push(e.data);
                recorder.onstop = () => {
                    const blob = new Blob(chunks, { type: 'audio/webm' });
                    const a = document.createElement('a');
                    a.href = URL.createObjectURL(blob);
                    a.download = `GENOME_AUDIO_${lane}.webm`; a.click();
                    recordStatus.classList.add('hidden');
                };
                recorder.start();
                recordStatus.classList.remove('hidden');
            }

            const step = 0.12; // Velocidad
            const bands = document.querySelectorAll(`.band-${lane.toLowerCase()}`);
            playhead.style.display = 'block';

            hash.split('').forEach((char, i) => {
                const startTime = ctx.currentTime + (i * step);
                const freq = frequencies[parseInt(char, 16)];
                
                // Conectar a parlantes y/o grabadora
                const output = isExport ? dest : ctx.destination;
                
                // A: Triangle (Brillante), B: Sine (Suave)
                const waveType = lane === 'A' ? 'triangle' : 'sine';
                createOscillatorNode(freq, startTime, step, waveType, 0.1, output);
                
                // Sincronización Visual
                setTimeout(() => {
                    playhead.style.left = `${(i * 1.5) + 2}%`;
                    if(bands[i]) bands[i].classList.add('playing');
                    setTimeout(() => bands[i]?.classList.remove('playing'), step * 1000);
                    
                    if(i === 63) {
                         if(isExport) setTimeout(() => recorder.stop(), 500);
                         setTimeout(() => playhead.style.display = 'none', 200);
                    }
                }, i * step * 1000);
            });
        }

        function exportAudio(lane) {
            playSequence(lane, true);
        }

        async function playDualSync() {
            const ctx = initAudio();
            if (ctx.state === 'suspended') await ctx.resume();
            
            playTone(440, 'square', 0.05); // Sonido Start Sync

            const step = 0.15; // Un poco más lento para apreciar la armonía
            const bandsA = document.querySelectorAll('.band-a');
            const bandsB = document.querySelectorAll('.band-b');
            playhead.style.display = 'block';

            for(let i=0; i<64; i++) {
                const startTime = ctx.currentTime + (i * step);
                
                // Disparar A
                if(dataA.hash[i]) {
                    const freqA = frequencies[parseInt(dataA.hash[i], 16)];
                    createOscillatorNode(freqA, startTime, step, 'triangle', 0.08, ctx.destination);
                }
                
                // Disparar B
                if(dataB.hash[i]) {
                    const freqB = frequencies[parseInt(dataB.hash[i], 16)];
                    createOscillatorNode(freqB, startTime, step, 'sine', 0.08, ctx.destination);
                }

                // Visuales
                setTimeout(() => {
                    playhead.style.left = `${(i * 1.5) + 2}%`;
                    if(bandsA[i]) bandsA[i].classList.add('playing');
                    if(bandsB[i]) bandsB[i].classList.add('playing');
                    
                    setTimeout(() => {
                        bandsA[i]?.classList.remove('playing');
                        bandsB[i]?.classList.remove('playing');
                    }, step * 1000);

                    if(i === 63) setTimeout(() => playhead.style.display = 'none', 200);
                }, i * step * 1000);
            }
        }

        // --- MOTOR CRIPTOGRÁFICO ---
        async function getSHA256(data) {
            const buffer = typeof data === 'string' ? new TextEncoder().encode(data) : data;
            const hashBuffer = await crypto.subtle.digest('SHA-256', buffer);
            return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');
        }

        async function updateLane(lane, inputData, fileName) {
            playTone(1200, 'sine', 0.02); // Sonido de carga
            const hash = await getSHA256(inputData);
            
            if(lane === 'A') {
                dataA = { hash, name: fileName };
                document.getElementById('nameA').innerText = fileName;
                document.getElementById('labelA').innerText = `[${fileName}]`;
                document.getElementById('labelA').style.opacity = '1';
                document.getElementById('hashA').innerText = hash.toUpperCase();
            } else {
                dataB = { hash, name: fileName };
                document.getElementById('nameB').innerText = fileName;
                document.getElementById('labelB').innerText = `[${fileName}]`;
                document.getElementById('labelB').style.opacity = '1';
                document.getElementById('hashB').innerText = hash.toUpperCase();
            }
            render();
        }

        // --- RENDERIZADO VISUAL ---
        function render() {
            visualizer.innerHTML = '<div id="playhead"></div><div class="lane-divider"></div>';
            
            // 1. Dibujar Bandas
            [dataA, dataB].forEach((d, idx) => {
                if(!d.hash) return;
                const laneClass = idx === 0 ? 'band-a' : 'band-b';
                
                d.hash.split('').forEach((c, i) => {
                    const val = parseInt(c, 16);
                    const bar = document.createElement('div');
                    bar.className = `dna-band absolute w-[1.2%] ${laneClass}`;
                    bar.style.left = `${(i * 1.5) + 2}%`;
                    // Offset vertical para separar carriles
                    const yOffset = idx === 0 ? 0 : 50;
                    bar.style.top = `${yOffset + (val / 15) * 40}%`;
                    bar.style.height = `${8 + (val % 8)}px`;
                    bar.style.opacity = 0.6 + (val/30);
                    visualizer.appendChild(bar);
                });
            });

            // 2. Dibujar Picos (Cromatograma)
            const w = peakCanvas.width = peakCanvas.offsetWidth;
            const h = peakCanvas.height = peakCanvas.offsetHeight;
            pCtx.clearRect(0,0,w,h);
            
            // Línea A
            if(dataA.hash) {
                pCtx.beginPath(); pCtx.strokeStyle = 'rgba(37, 99, 235, 0.8)'; pCtx.lineWidth = 2;
                dataA.hash.split('').forEach((c,i) => pCtx.lineTo((i/64)*w, h-((parseInt(c,16)+1)/16)*h));
                pCtx.stroke();
            }
            // Línea B
            if(dataB.hash) {
                pCtx.beginPath(); pCtx.strokeStyle = 'rgba(5, 150, 105, 0.8)'; pCtx.lineWidth = 2;
                dataB.hash.split('').forEach((c,i) => pCtx.lineTo((i/64)*w, h-((parseInt(c,16)+1)/16)*h));
                pCtx.stroke();
            }

            // 3. Similitud
            if(dataA.hash && dataB.hash) {
                let matches = 0;
                for(let i=0; i<64; i++) if(dataA.hash[i] === dataB.hash[i]) matches++;
                const pct = ((matches/64)*100).toFixed(1);
                const color = pct == 100 ? 'text-green-600' : 'text-slate-500';
                document.getElementById('similarity').className = `mono font-bold text-xs ${color}`;
                document.getElementById('similarity').innerText = `SIMILITUD GENÉTICA: ${pct}% ${pct==100 ? 'MATCH' : ''}`;
            }
        }

        // --- EXPORTACIÓN IMAGEN INDIVIDUAL ---
        function exportLaneImage(lane) {
            playTone(700, 'triangle', 0.1); // Sonido Shutter corto
            const canvas = document.getElementById('exportCanvas');
            const ctx = canvas.getContext('2d');
            const data = lane === 'A' ? dataA : dataB;
            
            // Colores
            const primaryColor = lane === 'A' ? '#1e40af' : '#059669';
            const lightBg = lane === 'A' ? '#eff6ff' : '#ecfdf5';

            canvas.width = 1200; 
            canvas.height = 600; // Altura más compacta para una sola pista
            
            // Fondo
            ctx.fillStyle = '#ffffff'; ctx.fillRect(0,0,canvas.width,canvas.height);
            
            // Encabezado
            ctx.fillStyle = lightBg; ctx.fillRect(0,0,canvas.width,140);
            ctx.strokeStyle = primaryColor; ctx.lineWidth = 5; 
            ctx.strokeRect(0,0,canvas.width,canvas.height); // Borde general

            // Texto Header
            ctx.fillStyle = primaryColor; ctx.font = 'bold 30px Arial'; 
            ctx.fillText(`FICHA TÉCNICA - FUENTE ${lane}`, 50, 60);
            
            // Datos
            ctx.fillStyle = '#334155'; ctx.font = 'bold 20px Courier New';
            ctx.fillText(`ARCHIVO: ${data.name}`, 50, 100);
            
            ctx.font = '16px Courier New';
            ctx.fillStyle = '#64748b';
            ctx.fillText(`HASH: ${data.hash}`, 50, 125);
            
            // Visualización Gráfica
            ctx.fillStyle = '#f8fafc'; ctx.fillRect(50, 180, 1100, 380); // Caja de gel
            
            // Dibujar Bandas
            ctx.fillStyle = primaryColor;
            if(data.hash) data.hash.split('').forEach((c,i) => {
                const v = parseInt(c,16);
                // Mapear 0-15 a la altura de la caja (180 a 560)
                const yPos = 200 + (v/15) * 340;
                ctx.fillRect(70+(i*16.5), yPos, 14, 10);
            });

            // Descargar
            const link = document.createElement('a');
            link.download = `FICHA_FUENTE_${lane}.png`; 
            link.href = canvas.toDataURL(); 
            link.click();
        }

        // --- EXPORTACIÓN PNG COMPLETO ---
        document.getElementById('btnDownload').onclick = () => {
            playTone(600, 'triangle', 0.1); // Sonido Shutter
            const canvas = document.getElementById('exportCanvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 1200; canvas.height = 1200; // Cuadrado alto para reporte completo
            
            // Fondo
            ctx.fillStyle = '#ffffff'; ctx.fillRect(0,0,canvas.width,canvas.height);
            // Header
            ctx.fillStyle = '#0f172a'; ctx.fillRect(0,0,canvas.width,120);
            ctx.fillStyle = '#ffffff'; ctx.font = 'bold 30px Arial'; 
            ctx.fillText('REPORTE FORENSE CRYPTO-HASH LAB', 50, 70);
            
            // Datos
            ctx.fillStyle = '#334155'; ctx.font = '20px Courier New';
            ctx.fillText(`FUENTE A: ${dataA.name}`, 50, 180);
            ctx.fillText(`HASH A: ${dataA.hash}`, 50, 210);
            ctx.fillText(`FUENTE B: ${dataB.name}`, 50, 260);
            ctx.fillText(`HASH B: ${dataB.hash}`, 50, 290);
            
            // Gráfico Simulado
            ctx.fillStyle = '#f1f5f9'; ctx.fillRect(50, 350, 1100, 800);
            ctx.fillStyle = '#cbd5e1'; ctx.fillRect(50, 750, 1100, 5); // Divisor
            
            // Render A
            ctx.fillStyle = '#1e40af';
            if(dataA.hash) dataA.hash.split('').forEach((c,i) => {
                const v = parseInt(c,16);
                ctx.fillRect(70+(i*16.5), 370+(v/15)*350, 14, 10);
            });
            
            // Render B
            ctx.fillStyle = '#059669';
            if(dataB.hash) dataB.hash.split('').forEach((c,i) => {
                const v = parseInt(c,16);
                ctx.fillRect(70+(i*16.5), 770+(v/15)*350, 14, 10);
            });

            const link = document.createElement('a');
            link.download = 'REPORTE_FORENSE_LAB.png'; link.href = canvas.toDataURL(); link.click();
        };

        // --- EVENT LISTENERS ---
        // Lane A
        document.getElementById('textA').oninput = e => updateLane('A', e.target.value, "INPUT_MANUAL_A");
        document.getElementById('dropA').onclick = () => document.getElementById('fileA').click();
        document.getElementById('fileA').onchange = async e => { 
            if(e.target.files[0]) updateLane('A', await e.target.files[0].arrayBuffer(), e.target.files[0].name.toUpperCase()); 
        };
        // Lane B
        document.getElementById('textB').oninput = e => updateLane('B', e.target.value, "INPUT_MANUAL_B");
        document.getElementById('dropB').onclick = () => document.getElementById('fileB').click();
        document.getElementById('fileB').onchange = async e => { 
            if(e.target.files[0]) updateLane('B', await e.target.files[0].arrayBuffer(), e.target.files[0].name.toUpperCase()); 
        };

        // Init
        window.onload = () => {
            updateLane('A', "MUESTRA_BASE", "SISTEMA_INIT_A");
            updateLane('B', "MUESTRA_COMP", "SISTEMA_INIT_B");
        };
    </script>
</body>
</html>
